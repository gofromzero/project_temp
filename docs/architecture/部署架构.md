# 部署架构

## 部署策略

**前端部署：**
- **平台：** Vercel/Netlify/自建CDN
- **构建命令：** `npm run build`
- **输出目录：** `frontend/apps/admin-web/dist`
- **CDN/边缘：** 全球CDN加速，静态资源缓存

**后端部署：**
- **平台：** Kubernetes集群/云服务器
- **构建命令：** `go build -o app cmd/main.go`
- **部署方法：** Docker容器化部署，多副本负载均衡

## CI/CD流水线

```yaml
name: Build and Deploy
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      # 后端测试
      - name: Run Go tests
        run: |
          cd backend
          go test ./...
      
      # 前端测试
      - name: Install frontend dependencies
        run: |
          cd frontend
          npm ci
      
      - name: Run frontend tests
        run: |
          cd frontend
          npm run test
          
      # E2E测试
      - name: Run E2E tests
        run: |
          npm run test:e2e

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3
      
      # 构建后端
      - name: Build backend Docker image
        run: |
          docker build -f infrastructure/docker/Dockerfile.backend -t backend:latest .
      
      # 构建前端
      - name: Build frontend
        run: |
          cd frontend
          npm ci
          npm run build
          
      # 部署到生产环境
      - name: Deploy to production
        run: |
          # Kubernetes部署命令
          kubectl apply -f infrastructure/k8s/
```

## 环境配置

| 环境 | 前端URL | 后端URL | 用途 |
|------|---------|---------|------|
| Development | http://localhost:3000 | http://localhost:8000 | 本地开发 |
| Staging | https://staging-admin.example.com | https://staging-api.example.com | 预生产测试 |
| Production | https://admin.example.com | https://api.example.com | 生产环境 |
